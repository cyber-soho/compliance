<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CyberRisk Command Center | Risk Analysis Module</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&family=JetBrains+Mono:wght@400;700&display=swap" rel="stylesheet">
    
    <!-- Chosen Palette: Secure Horizon -->
    <!-- Backgrounds: Slate-50 (Warm Neutral) to Slate-100 -->
    <!-- Primary Accents: Indigo-600 (Professional, Trust) -->
    <!-- Functional Colors: Emerald (Low Risk), Amber (Medium), Orange (High), Rose (Critical) -->
    
    <style>
        body { font-family: 'Inter', sans-serif; background-color: #f8fafc; color: #1e293b; }
        .font-mono { font-family: 'JetBrains Mono', monospace; }
        
        /* Smooth scrolling */
        html { scroll-behavior: smooth; }

        /* Chart Container Strategy */
        .chart-wrapper {
            position: relative;
            width: 100%;
            max-width: 600px;
            height: 350px;
            margin: 0 auto;
        }

        /* Custom Range Slider Styling */
        input[type=range] {
            -webkit-appearance: none; 
            width: 100%; 
            background: transparent; 
        }
        input[type=range]::-webkit-slider-thumb {
            -webkit-appearance: none;
            height: 20px;
            width: 20px;
            border-radius: 50%;
            background: #4f46e5;
            cursor: pointer;
            margin-top: -8px; 
            box-shadow: 0 2px 6px rgba(0,0,0,0.2);
        }
        input[type=range]::-webkit-slider-runnable-track {
            width: 100%;
            height: 4px;
            cursor: pointer;
            background: #cbd5e1;
            border-radius: 2px;
        }

        /* Matrix Cell Animation */
        .matrix-cell { transition: all 0.3s ease; }
        .matrix-cell.active { transform: scale(1.05); box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1); border: 2px solid #1e293b; z-index: 10; }

        /* Terminal Typing Effect */
        .typing-cursor::after {
            content: '‚ñã';
            animation: blink 1s step-start infinite;
        }
        @keyframes blink { 50% { opacity: 0; } }
        
        /* Accordion Transition */
        .accordion-content {
            transition: max-height 0.3s ease-out, opacity 0.3s ease-out;
            max-height: 0;
            opacity: 0;
            overflow: hidden;
        }
        .accordion-content.open {
            max-height: 500px; /* Arbitrary large height */
            opacity: 1;
        }
    </style>
    
    <!-- Application Structure Plan: 
         1. Hero Section: Sets the stage (CISO dilemma) and immediate value prop.
         2. The Risk Calculator: Interactive core. Allows users to manipulate Impact/Likelihood to understand the formula intuitively. Visualized with a Heatmap Matrix.
         3. Business Context Simulator: A "Compare" section. Users toggle between "Raw Technical Risk" and "Business Priority" to see how context changes decisions (Meeting Room vs Payroll).
         4. Defense in Depth (Compensating Controls): An "Organize" section using a layered stack UI to explain how to secure unpatchable systems (The CT Scanner).
         5. Verification Console: A "Wow" factor element. Simulated terminal to demonstrate the automated script concept.
    -->
    
    <!-- Visualization & Content Choices:
         - Risk Matrix: HTML Grid + JS Interaction. Best for showing the intersection of Impact/Likelihood.
         - Score Distribution: Chart.js Bar Chart. Used for the Business Context comparison to clearly show the "flip" in priority.
         - Terminal: Styled HTML Div + JS Timeout loops. Simulates the verification script realism without needing a backend.
         - Controls Stack: Vertical Accordion. Organizes complex list of compensating controls cleanly.
    -->
    
    <!-- CONFIRMATION: NO SVG graphics used. NO Mermaid JS used. -->
</head>
<body class="antialiased">

    <!-- Navigation -->
    <nav class="sticky top-0 z-50 bg-white/90 backdrop-blur-md border-b border-slate-200 shadow-sm">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between h-16 items-center">
                <div class="flex items-center gap-2">
                    <span class="text-2xl">üõ°Ô∏è</span>
                    <span class="font-bold text-slate-800 tracking-tight">CyberRisk<span class="text-indigo-600">Command</span></span>
                </div>
                <div class="hidden md:flex space-x-8 text-sm font-medium text-slate-600">
                    <a href="#calculator" class="hover:text-indigo-600 transition">Risk Calculator</a>
                    <a href="#business-context" class="hover:text-indigo-600 transition">Business Context</a>
                    <a href="#defense" class="hover:text-indigo-600 transition">Compensating Controls</a>
                    <a href="#verification" class="hover:text-indigo-600 transition">Verification</a>
                </div>
            </div>
        </div>
    </nav>

    <!-- Hero Section -->
    <header class="bg-gradient-to-b from-slate-50 to-slate-100 py-16 lg:py-24">
        <div class="max-w-5xl mx-auto px-4 sm:px-6 lg:px-8 text-center">
            <div class="inline-flex items-center rounded-full bg-indigo-50 px-3 py-1 text-sm font-medium text-indigo-700 mb-6 border border-indigo-100">
                Module 12: Cybersecurity Compliance Assessments
            </div>
            <h1 class="text-4xl lg:text-5xl font-bold text-slate-900 mb-6 tracking-tight leading-tight">
                What Should You Fix First?
            </h1>
            <p class="text-xl text-slate-600 max-w-2xl mx-auto mb-10 leading-relaxed">
                You have limited budget, limited time, and unlimited problems. Risk Analysis is the art of translating technical vulnerabilities into business decisions. Master the formula that drives every CISO's strategy.
            </p>
            <a href="#calculator" class="inline-flex items-center justify-center px-8 py-3 border border-transparent text-base font-medium rounded-lg text-white bg-indigo-600 hover:bg-indigo-700 md:text-lg transition shadow-lg shadow-indigo-200">
                Start Analysis
            </a>
        </div>
    </header>

    <!-- Section 1: The Risk Calculator -->
    <section id="calculator" class="py-20 bg-white">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="max-w-3xl mb-12">
                <h2 class="text-3xl font-bold text-slate-900 mb-4">The Risk Formula</h2>
                <p class="text-lg text-slate-600">
                    At its core, cybersecurity decision-making relies on a simple yet powerful equation: 
                    <span class="font-mono bg-slate-100 px-2 py-1 rounded text-indigo-700 font-bold">Risk Score = Impact √ó Likelihood</span>.
                    Use the interactive calculator below to see how these two variables determine the severity of a finding.
                </p>
            </div>

            <div class="grid grid-cols-1 lg:grid-cols-2 gap-12 items-start">
                
                <!-- Controls Side -->
                <div class="bg-slate-50 rounded-2xl p-8 border border-slate-200 shadow-sm">
                    <h3 class="text-xl font-bold text-slate-800 mb-6">Input Parameters</h3>
                    
                    <!-- Impact Slider -->
                    <div class="mb-8">
                        <div class="flex justify-between items-end mb-2">
                            <label class="text-sm font-semibold text-slate-500 uppercase tracking-wider">Impact Score</label>
                            <span id="impact-val" class="text-2xl font-bold text-indigo-600">3</span>
                        </div>
                        <input type="range" id="impact-slider" min="1" max="5" value="3" class="mb-2">
                        <div id="impact-desc" class="text-sm text-slate-600 bg-white p-3 rounded border border-slate-100 shadow-sm">
                            <strong>Medium:</strong> Significant business disruption (e.g., website defaced).
                        </div>
                    </div>

                    <!-- Likelihood Slider -->
                    <div class="mb-8">
                        <div class="flex justify-between items-end mb-2">
                            <label class="text-sm font-semibold text-slate-500 uppercase tracking-wider">Likelihood Score</label>
                            <span id="likelihood-val" class="text-2xl font-bold text-indigo-600">3</span>
                        </div>
                        <input type="range" id="likelihood-slider" min="1" max="5" value="3" class="mb-2">
                        <div id="likelihood-desc" class="text-sm text-slate-600 bg-white p-3 rounded border border-slate-100 shadow-sm">
                            <strong>Possible:</strong> We've seen similar attacks in our industry.
                        </div>
                    </div>

                    <!-- Result Box -->
                    <div class="bg-slate-800 rounded-xl p-6 text-white text-center">
                        <div class="text-sm text-slate-400 uppercase tracking-wider mb-1">Calculated Risk Score</div>
                        <div class="flex items-center justify-center gap-2 mb-2">
                            <span id="calc-impact" class="text-xl font-mono text-slate-300">3</span>
                            <span class="text-slate-500">√ó</span>
                            <span id="calc-likelihood" class="text-xl font-mono text-slate-300">3</span>
                            <span class="text-slate-500">=</span>
                            <span id="calc-result" class="text-4xl font-bold text-white">9</span>
                        </div>
                        <div id="risk-category-badge" class="inline-block px-3 py-1 rounded text-xs font-bold bg-yellow-500 text-slate-900">
                            MEDIUM RISK
                        </div>
                        <div id="remediation-text" class="mt-3 text-sm text-slate-300">
                            Schedule remediation within 90 days.
                        </div>
                    </div>
                </div>

                <!-- Matrix Visualization Side -->
                <div class="flex flex-col items-center">
                    <h3 class="text-lg font-semibold text-slate-700 mb-4">Risk Matrix Visualization</h3>
                    <div class="relative p-4 bg-white rounded-xl shadow-lg border border-slate-100">
                        <!-- Y Axis Label -->
                        <div class="absolute -left-8 top-1/2 -translate-y-1/2 -rotate-90 text-xs font-bold text-slate-400 tracking-widest">LIKELIHOOD</div>
                        
                        <!-- The Grid -->
                        <div class="grid grid-cols-5 gap-1 mb-2" id="risk-matrix">
                            <!-- JS Generates Cells Here -->
                        </div>

                        <!-- X Axis Label -->
                        <div class="text-center text-xs font-bold text-slate-400 tracking-widest mt-2">IMPACT</div>
                    </div>
                    
                    <div class="mt-6 grid grid-cols-2 gap-4 text-xs text-slate-500 w-full max-w-md">
                        <div class="flex items-center gap-2"><div class="w-3 h-3 bg-emerald-200 rounded"></div> Low (1-4)</div>
                        <div class="flex items-center gap-2"><div class="w-3 h-3 bg-amber-200 rounded"></div> Medium (5-9)</div>
                        <div class="flex items-center gap-2"><div class="w-3 h-3 bg-orange-300 rounded"></div> High (10-14)</div>
                        <div class="flex items-center gap-2"><div class="w-3 h-3 bg-orange-500 rounded"></div> Very High (15-19)</div>
                        <div class="flex items-center gap-2"><div class="w-3 h-3 bg-rose-600 rounded"></div> Critical (20-25)</div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Section 2: Business Context -->
    <section id="business-context" class="py-20 bg-slate-50 border-t border-slate-200">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="max-w-3xl mb-10">
                <h2 class="text-3xl font-bold text-slate-900 mb-4">Context Changes Everything</h2>
                <p class="text-lg text-slate-600">
                    A raw risk score is just a number. Real-world prioritization requires applying the <strong>Business Criticality Multiplier</strong>. Two identical technical scores can have drastically different priorities when you factor in revenue, regulation, and reputation.
                </p>
            </div>

            <div class="bg-white rounded-2xl shadow-sm border border-slate-200 overflow-hidden">
                <div class="p-6 md:p-8 border-b border-slate-100">
                    <div class="flex flex-col md:flex-row justify-between items-center gap-4">
                        <h3 class="text-xl font-bold text-slate-800">Scenario: The Tale of Two SQL Injections</h3>
                        <div class="flex bg-slate-100 p-1 rounded-lg">
                            <button id="btn-technical" class="px-4 py-2 text-sm font-medium rounded-md bg-white text-indigo-600 shadow-sm transition-all" onclick="updateContextMode('technical')">Technical Risk Score</button>
                            <button id="btn-business" class="px-4 py-2 text-sm font-medium rounded-md text-slate-600 hover:text-slate-900 transition-all" onclick="updateContextMode('business')">Effective Business Priority</button>
                        </div>
                    </div>
                </div>

                <div class="grid grid-cols-1 lg:grid-cols-2 gap-0">
                    <!-- Text Details -->
                    <div class="p-6 md:p-8 bg-slate-50/50">
                        <div class="space-y-6">
                            <!-- Finding A -->
                            <div class="bg-white p-4 rounded-xl border border-slate-200 shadow-sm relative overflow-hidden group hover:border-indigo-200 transition">
                                <div class="absolute top-0 left-0 w-1 h-full bg-slate-400 group-hover:bg-indigo-400 transition"></div>
                                <div class="flex justify-between items-start mb-2">
                                    <h4 class="font-bold text-slate-800">Finding A: Meeting Rooms</h4>
                                    <span class="text-xs font-mono bg-slate-100 px-2 py-1 rounded text-slate-600">Tier 3 System</span>
                                </div>
                                <p class="text-sm text-slate-600 mb-3">SQL Injection in booking search. Can leak employee names and schedules.</p>
                                <ul class="text-xs text-slate-500 space-y-1">
                                    <li>‚Ä¢ Impact: 3 (Medium)</li>
                                    <li>‚Ä¢ Likelihood: 4 (Likely)</li>
                                    <li>‚Ä¢ Compliance: None</li>
                                </ul>
                            </div>

                            <!-- Finding B -->
                            <div class="bg-white p-4 rounded-xl border border-slate-200 shadow-sm relative overflow-hidden group hover:border-indigo-200 transition">
                                <div class="absolute top-0 left-0 w-1 h-full bg-slate-400 group-hover:bg-indigo-400 transition"></div>
                                <div class="flex justify-between items-start mb-2">
                                    <h4 class="font-bold text-slate-800">Finding B: Payroll DB</h4>
                                    <span class="text-xs font-mono bg-indigo-100 px-2 py-1 rounded text-indigo-700 font-bold">Tier 1 Critical</span>
                                </div>
                                <p class="text-sm text-slate-600 mb-3">Weak authentication on database. Can leak SSNs, bank info.</p>
                                <ul class="text-xs text-slate-500 space-y-1">
                                    <li>‚Ä¢ Impact: 3 (Medium)</li>
                                    <li>‚Ä¢ Likelihood: 4 (Likely)</li>
                                    <li>‚Ä¢ Compliance: <span class="text-rose-600 font-bold">SOX & PCI-DSS</span></li>
                                </ul>
                            </div>
                        </div>
                        <div class="mt-6 p-4 bg-blue-50 text-blue-800 text-sm rounded-lg border border-blue-100">
                            <strong class="block mb-1">Key Insight:</strong>
                            <span id="insight-text">Without business context, these two findings look identical (Risk Score: 12). Toggle the view to see reality.</span>
                        </div>
                    </div>

                    <!-- Chart Container -->
                    <div class="p-6 md:p-8 flex items-center justify-center bg-white">
                        <div class="chart-wrapper">
                            <canvas id="businessChart"></canvas>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Section 3: Compensating Controls -->
    <section id="defense" class="py-20 bg-white border-t border-slate-200">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="max-w-3xl mb-12">
                <h2 class="text-3xl font-bold text-slate-900 mb-4">The "Unpatchable" Dilemma</h2>
                <p class="text-lg text-slate-600">
                    Sometimes you can't fix the root cause. A \$1.2M MRI scanner running Windows 7 cannot be patched without voiding FDA certification. In these cases, we build <strong>Compensating Controls</strong>‚Äîlayers of defense that effectively mitigate the risk.
                </p>
            </div>

            <div class="grid grid-cols-1 lg:grid-cols-12 gap-12">
                <!-- Visual Stack -->
                <div class="lg:col-span-5 space-y-4">
                    <h3 class="text-sm font-bold text-slate-400 uppercase tracking-widest mb-4">Defense In Depth Strategy</h3>
                    
                    <!-- Layer 1 -->
                    <div class="control-layer cursor-pointer transform transition hover:-translate-y-1" onclick="toggleLayer('layer1')">
                        <div class="bg-slate-800 text-white p-4 rounded-lg shadow-md border-l-4 border-emerald-400 flex justify-between items-center">
                            <div class="flex items-center gap-3">
                                <span class="text-2xl">üåê</span>
                                <div>
                                    <div class="font-bold">1. Network Layer</div>
                                    <div class="text-xs text-slate-400">Segmentation & Isolation</div>
                                </div>
                            </div>
                            <span class="text-slate-400">‚ñº</span>
                        </div>
                        <div id="layer1" class="accordion-content bg-slate-50 border border-slate-200 rounded-b-lg mx-2 text-sm p-4 text-slate-700">
                            <ul class="list-disc pl-4 space-y-2">
                                <li><strong>VLAN Isolation:</strong> Scanner sits on a dedicated medical device VLAN.</li>
                                <li><strong>Firewall Rules:</strong> Blocks all internet access. Only allows traffic to internal PACS server.</li>
                                <li><strong>Air-Gap:</strong> No physical connection to guest Wi-Fi.</li>
                            </ul>
                        </div>
                    </div>

                    <!-- Layer 2 -->
                    <div class="control-layer cursor-pointer transform transition hover:-translate-y-1" onclick="toggleLayer('layer2')">
                        <div class="bg-slate-700 text-white p-4 rounded-lg shadow-md border-l-4 border-blue-400 flex justify-between items-center">
                            <div class="flex items-center gap-3">
                                <span class="text-2xl">üõ°Ô∏è</span>
                                <div>
                                    <div class="font-bold">2. Application Layer</div>
                                    <div class="text-xs text-slate-400">Whitelisting & Restrictions</div>
                                </div>
                            </div>
                            <span class="text-slate-400">‚ñº</span>
                        </div>
                        <div id="layer2" class="accordion-content bg-slate-50 border border-slate-200 rounded-b-lg mx-2 text-sm p-4 text-slate-700">
                            <ul class="list-disc pl-4 space-y-2">
                                <li><strong>AppLocker:</strong> Only digitally signed binaries from the vendor can execute.</li>
                                <li><strong>Script Blocking:</strong> PowerShell and VBScript disabled entirely.</li>
                                <li><strong>USB Disabled:</strong> Physical ports glued or disabled in BIOS.</li>
                            </ul>
                        </div>
                    </div>

                    <!-- Layer 3 -->
                    <div class="control-layer cursor-pointer transform transition hover:-translate-y-1" onclick="toggleLayer('layer3')">
                        <div class="bg-slate-600 text-white p-4 rounded-lg shadow-md border-l-4 border-amber-400 flex justify-between items-center">
                            <div class="flex items-center gap-3">
                                <span class="text-2xl">üëÅÔ∏è</span>
                                <div>
                                    <div class="font-bold">3. Monitoring Layer</div>
                                    <div class="text-xs text-slate-400">Detection & Response</div>
                                </div>
                            </div>
                            <span class="text-slate-400">‚ñº</span>
                        </div>
                        <div id="layer3" class="accordion-content bg-slate-50 border border-slate-200 rounded-b-lg mx-2 text-sm p-4 text-slate-700">
                            <ul class="list-disc pl-4 space-y-2">
                                <li><strong>Network IDS:</strong> Snort sensor inspecting all traffic to/from scanner.</li>
                                <li><strong>Log Aggregation:</strong> All access attempts sent to SIEM.</li>
                                <li><strong>Daily Review:</strong> Security analyst reviews logs manually every 24 hours.</li>
                            </ul>
                        </div>
                    </div>
                </div>

                <!-- Context Panel -->
                <div class="lg:col-span-7 bg-slate-50 rounded-2xl p-8 border border-slate-200">
                    <h3 class="text-xl font-bold text-slate-800 mb-4">The Requirements</h3>
                    <p class="text-slate-600 mb-6">
                        For a compensating control to be valid under PCI-DSS or HIPAA, it must meet four strict criteria. Click the layers on the left to see how we satisfy them.
                    </p>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div class="bg-white p-4 rounded-lg border border-slate-200">
                            <div class="font-bold text-indigo-600 text-sm mb-1">1. Meet the Intent</div>
                            <div class="text-xs text-slate-500">Must provide similar protection to the original requirement (patching).</div>
                        </div>
                        <div class="bg-white p-4 rounded-lg border border-slate-200">
                            <div class="font-bold text-indigo-600 text-sm mb-1">2. Sufficient Defense</div>
                            <div class="text-xs text-slate-500">Must reduce risk to an acceptable level, validated by testing.</div>
                        </div>
                        <div class="bg-white p-4 rounded-lg border border-slate-200">
                            <div class="font-bold text-indigo-600 text-sm mb-1">3. Above & Beyond</div>
                            <div class="text-xs text-slate-500">Cannot be a control you were already supposed to have in place.</div>
                        </div>
                        <div class="bg-white p-4 rounded-lg border border-slate-200">
                            <div class="font-bold text-indigo-600 text-sm mb-1">4. Address Risk</div>
                            <div class="text-xs text-slate-500">Must directly target the specific vulnerability (e.g., RCE).</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Section 4: Automated Verification -->
    <section id="verification" class="py-20 bg-slate-900 text-slate-200">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex flex-col lg:flex-row gap-12 items-center">
                <div class="lg:w-1/2">
                    <h2 class="text-3xl font-bold text-white mb-4">Trust, But Verify</h2>
                    <p class="text-lg text-slate-400 mb-6">
                        Compensating controls are complex and prone to failure ("drift"). If the firewall rule is accidentally deleted, your unpatchable scanner is exposed.
                    </p>
                    <p class="text-slate-400 mb-8">
                        Professional security teams use automated scripts (cron jobs) to validate controls every few hours. Click the button to simulate a live verification run of the <code class="bg-slate-800 px-1 py-0.5 rounded text-indigo-400">verify-compensating-controls.sh</code> script.
                    </p>
                    <button onclick="runVerification()" id="run-btn" class="bg-emerald-600 hover:bg-emerald-500 text-white font-bold py-3 px-6 rounded-lg shadow-lg shadow-emerald-900/50 transition flex items-center gap-2">
                        <span class="text-lg">‚ñ∂</span> Run Verification Script
                    </button>
                </div>
                
                <div class="lg:w-1/2 w-full">
                    <div class="bg-slate-950 rounded-lg shadow-2xl overflow-hidden border border-slate-700 font-mono text-xs md:text-sm relative">
                        <!-- Terminal Header -->
                        <div class="bg-slate-800 px-4 py-2 flex items-center gap-2 border-b border-slate-700">
                            <div class="flex gap-1.5">
                                <div class="w-3 h-3 rounded-full bg-red-500"></div>
                                <div class="w-3 h-3 rounded-full bg-yellow-500"></div>
                                <div class="w-3 h-3 rounded-full bg-green-500"></div>
                            </div>
                            <div class="ml-2 text-slate-400">root@medcare-sec-ops:~</div>
                        </div>
                        
                        <!-- Terminal Body -->
                        <div id="terminal-output" class="p-4 h-[300px] overflow-y-auto text-slate-300">
                            <div class="text-slate-500"># Click 'Run Verification' to start checks...</div>
                            <span class="typing-cursor"></span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer class="bg-white border-t border-slate-200 py-12">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 text-center">
            <p class="text-slate-500 text-sm mb-4">
            </p>
            <p class="text-slate-400 text-xs max-w-2xl mx-auto">
                Disclaimer: This tool is for educational purposes only. The risk scores and scenarios presented are simplified for instruction. Real-world risk analysis involves complex variables and should be conducted by qualified professionals.
            </p>
            <p class="text-slate-400 text-xs mt-4">
                ¬© 2026 Cyber.SoHo. All Rights Reserved.
            </p>
        </div>
    </footer>

    <!-- Application Logic -->
    <script>
        // --- DATA & CONFIG ---
        const impactDefs = {
            1: "Minimal: Annoying but survivable.",
            2: "Low: Noticeable but contained.",
            3: "Medium: Significant business disruption.",
            4: "High: Major operational/financial damage.",
            5: "Critical: Catastrophic, life-safety."
        };

        const likelihoodDefs = {
            1: "Rare: Extraordinary circumstances.",
            2: "Unlikely: Possible but not seen.",
            3: "Possible: Seen in industry.",
            4: "Likely: Common, regular attempts.",
            5: "Almost Certain: Daily occurrence."
        };

        const riskCategories = [
            { max: 4, label: "LOW RISK", color: "bg-emerald-500", text: "Monitor, fix when convenient." },
            { max: 9, label: "MEDIUM RISK", color: "bg-yellow-500", text: "Schedule remediation within 90 days." },
            { max: 14, label: "HIGH RISK", color: "bg-orange-500", text: "Schedule remediation within 30 days." },
            { max: 19, label: "VERY HIGH", color: "bg-orange-600", text: "Remediate within 7 days." },
            { max: 25, label: "CRITICAL", color: "bg-rose-600", text: "Emergency response. Fix immediately." }
        ];

        // --- RISK CALCULATOR LOGIC ---
        const iSlider = document.getElementById('impact-slider');
        const lSlider = document.getElementById('likelihood-slider');
        
        function updateCalculator() {
            const i = parseInt(iSlider.value);
            const l = parseInt(lSlider.value);
            const score = i * l;

            // Update UI Numbers
            document.getElementById('impact-val').innerText = i;
            document.getElementById('likelihood-val').innerText = l;
            document.getElementById('calc-impact').innerText = i;
            document.getElementById('calc-likelihood').innerText = l;
            document.getElementById('calc-result').innerText = score;

            // Update Descriptions
            document.getElementById('impact-desc').innerHTML = `<strong>Level ${i}:</strong> ${impactDefs[i]}`;
            document.getElementById('likelihood-desc').innerHTML = `<strong>Level ${l}:</strong> ${likelihoodDefs[l]}`;

            // Update Category Badge & Text
            const cat = riskCategories.find(c => score <= c.max) || riskCategories[4];
            const badge = document.getElementById('risk-category-badge');
            badge.innerText = cat.label;
            badge.className = `inline-block px-3 py-1 rounded text-xs font-bold text-white shadow-sm ${cat.color}`;
            document.getElementById('remediation-text').innerText = cat.text;

            // Update Matrix Highlight
            document.querySelectorAll('.matrix-cell').forEach(cell => {
                cell.classList.remove('active', 'ring-2', 'ring-indigo-600', 'z-10');
                if (parseInt(cell.dataset.i) === i && parseInt(cell.dataset.l) === l) {
                    cell.classList.add('active');
                }
            });
        }

        function initMatrix() {
            const container = document.getElementById('risk-matrix');
            // Generate 5x5 grid (Likelihood Y-axis inverted for visual standard)
            // L goes 5 (top) down to 1 (bottom). I goes 1 (left) to 5 (right).
            for (let l = 5; l >= 1; l--) {
                for (let i = 1; i <= 5; i++) {
                    const cell = document.createElement('div');
                    const score = i * l;
                    let colorClass = 'bg-emerald-200';
                    if (score >= 20) colorClass = 'bg-rose-600';
                    else if (score >= 15) colorClass = 'bg-orange-500';
                    else if (score >= 10) colorClass = 'bg-orange-300';
                    else if (score >= 5) colorClass = 'bg-amber-200';

                    cell.className = `matrix-cell h-8 w-full rounded-sm cursor-default flex items-center justify-center text-xs font-bold text-slate-800/60 hover:opacity-90 ${colorClass}`;
                    cell.innerText = score;
                    cell.dataset.i = i;
                    cell.dataset.l = l;
                    cell.title = `Impact: ${i}, Likelihood: ${l}`;
                    container.appendChild(cell);
                }
            }
        }

        iSlider.addEventListener('input', updateCalculator);
        lSlider.addEventListener('input', updateCalculator);

        // --- BUSINESS CONTEXT CHART ---
        let businessChartInstance = null;
        
        // Data derived from Lesson 2
        const findingA = {
            name: "Meeting Rooms",
            techScore: 12,
            businessMult: 0.5,
            exploitMult: 2.0,
            complianceBonus: 1.0,
            get effective() { return this.techScore * this.businessMult * this.exploitMult * this.complianceBonus; }
        };
        
        const findingB = {
            name: "Payroll DB",
            techScore: 12,
            businessMult: 2.0, // Tier 1 (x2)
            exploitMult: 1.5,
            complianceBonus: 1.5, // Compliance (x1.5)
            get effective() { return this.techScore * this.businessMult * this.exploitMult * this.complianceBonus; }
        };

        function initBusinessChart() {
            const ctx = document.getElementById('businessChart').getContext('2d');
            businessChartInstance = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: ['Meeting Room SQLi', 'Payroll DB Weak Auth'],
                    datasets: [{
                        label: 'Risk Score',
                        data: [12, 12],
                        backgroundColor: ['#94a3b8', '#94a3b8'], // Slate-400
                        borderRadius: 6
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { display: false },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return `Score: ${context.raw}`;
                                }
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: 60,
                            title: { display: true, text: 'Score' }
                        }
                    },
                    animation: {
                        duration: 800,
                        easing: 'easeOutQuart'
                    }
                }
            });
        }

        function updateContextMode(mode) {
            const btnTech = document.getElementById('btn-technical');
            const btnBiz = document.getElementById('btn-business');
            const insightText = document.getElementById('insight-text');

            if (mode === 'technical') {
                // UI State
                btnTech.classList.add('bg-white', 'text-indigo-600', 'shadow-sm');
                btnTech.classList.remove('text-slate-600');
                btnBiz.classList.remove('bg-white', 'text-indigo-600', 'shadow-sm');
                btnBiz.classList.add('text-slate-600');
                
                // Chart Data
                businessChartInstance.data.datasets[0].data = [findingA.techScore, findingB.techScore];
                businessChartInstance.data.datasets[0].backgroundColor = ['#94a3b8', '#94a3b8'];
                businessChartInstance.data.datasets[0].label = "Raw Risk Score";
                insightText.innerText = "Without business context, these two findings look identical (Risk Score: 12). Toggle the view to see reality.";
            } else {
                // UI State
                btnBiz.classList.add('bg-white', 'text-indigo-600', 'shadow-sm');
                btnBiz.classList.remove('text-slate-600');
                btnTech.classList.remove('bg-white', 'text-indigo-600', 'shadow-sm');
                btnTech.classList.add('text-slate-600');

                // Chart Data
                businessChartInstance.data.datasets[0].data = [findingA.effective, findingB.effective];
                businessChartInstance.data.datasets[0].backgroundColor = ['#cbd5e1', '#e11d48']; // Gray vs Red
                businessChartInstance.data.datasets[0].label = "Effective Priority";
                insightText.innerText = `Payroll jumps to 54 (Emergency) due to Business Tier 1 (x2) and Compliance (x1.5). Meeting rooms drop to 12.`;
            }
            businessChartInstance.update();
        }

        // --- COMPENSATING CONTROLS ACCORDION ---
        function toggleLayer(id) {
            const content = document.getElementById(id);
            const isOpen = content.classList.contains('open');
            
            // Close all first (optional, purely preference)
            document.querySelectorAll('.accordion-content').forEach(el => el.classList.remove('open'));
            
            if (!isOpen) {
                content.classList.add('open');
            }
        }

        // --- VERIFICATION SCRIPT SIMULATION ---
        const scriptSteps = [
            { text: "Starting Compensating Controls Verification...", delay: 500, color: "text-yellow-400" },
            { text: "1. Verifying Network IDS (snort)...", delay: 1000, color: "text-slate-300" },
            { text: "[PASS] Process 'snort' is running", delay: 1500, color: "text-emerald-400" },
            { text: "2. Verifying AppLocker...", delay: 2000, color: "text-slate-300" },
            { text: "[PASS] Process 'applocker' is running", delay: 2500, color: "text-emerald-400" },
            { text: "3. Verifying Firewall Rules...", delay: 3000, color: "text-slate-300" },
            { text: "[PASS] Rule verified: DROP * 192.168.100.50", delay: 3500, color: "text-emerald-400" },
            { text: "[PASS] Rule verified: ACCEPT * 192.168.100.10", delay: 3800, color: "text-emerald-400" },
            { text: "4. Verifying Port Security...", delay: 4500, color: "text-slate-300" },
            { text: "[PASS] Port 3389 (RDP) blocked", delay: 5000, color: "text-emerald-400" },
            { text: "[PASS] Port 445 (SMB) blocked", delay: 5200, color: "text-emerald-400" },
            { text: "5. Verifying USB Security...", delay: 6000, color: "text-slate-300" },
            { text: "[PASS] No USB storage devices detected", delay: 6500, color: "text-emerald-400" },
            { text: "=========================================", delay: 7000, color: "text-yellow-400" },
            { text: "VERIFICATION SUMMARY", delay: 7100, color: "text-yellow-400" },
            { text: "Total Checks: 8 | Passed: 8 | Failed: 0", delay: 7300, color: "text-white" },
            { text: "SUCCESS: All compensating controls verified.", delay: 7500, color: "text-emerald-400 font-bold" }
        ];

        function runVerification() {
            const terminal = document.getElementById('terminal-output');
            const btn = document.getElementById('run-btn');
            
            // Reset
            terminal.innerHTML = '<span class="typing-cursor"></span>';
            btn.disabled = true;
            btn.classList.add('opacity-50', 'cursor-not-allowed');

            let accumulatedDelay = 0;

            scriptSteps.forEach(step => {
                accumulatedDelay = step.delay;
                setTimeout(() => {
                    // Remove cursor
                    const cursor = terminal.querySelector('.typing-cursor');
                    if (cursor) cursor.remove();

                    // Add line
                    const line = document.createElement('div');
                    line.className = `font-mono mb-1 ${step.color}`;
                    line.innerText = step.text;
                    terminal.appendChild(line);

                    // Re-add cursor
                    const newCursor = document.createElement('span');
                    newCursor.className = 'typing-cursor';
                    terminal.appendChild(newCursor);
                    
                    // Auto scroll
                    terminal.scrollTop = terminal.scrollHeight;
                }, step.delay);
            });

            // Re-enable button
            setTimeout(() => {
                btn.disabled = false;
                btn.classList.remove('opacity-50', 'cursor-not-allowed');
            }, accumulatedDelay + 500);
        }

        // --- INITIALIZATION ---
        window.onload = function() {
            initMatrix();
            updateCalculator();
            initBusinessChart();
        };

    </script>
</body>
</html>


