<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Module 9: Third-Party & Cloud Compliance | Cyber.SoHo</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body { font-family: 'Inter', sans-serif; background-color: #FDFBF7; color: #1F2937; }
        .chart-container { position: relative; width: 100%; max-width: 500px; margin: 0 auto; height: 300px; max-height: 400px; }
        @media (min-width: 768px) { .chart-container { height: 350px; } }
        .active-nav { border-bottom: 2px solid #D97706; color: #D97706; font-weight: 600; }
        .cyber-card { background-color: white; border: 1px solid #E5E7EB; box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05); border-radius: 0.5rem; transition: all 0.3s ease; }
        .cyber-card:hover { box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1); }
        .toggle-checkbox:checked { right: 0; border-color: #10B981; }
        .toggle-checkbox:checked + .toggle-label { background-color: #10B981; }
        pre { background: #1F2937; color: #E5E7EB; padding: 1rem; border-radius: 0.5rem; overflow-x: auto; font-size: 0.875rem; }
    </style>
    <!-- Chosen Palette: Warm Neutrals (Background #FDFBF7) with Technical Accents (Amber #D97706 for headers/action, Emerald #10B981 for success, Red #EF4444 for risk, Slate #1F2937 for text/code). Designed to feel like a modern, accessible educational dashboard. -->
    
    <!-- Application Structure Plan: 
         1. **Mission Control (Home)**: Sets the stage with the "Why" - Vendor Risk context.
         2. **Vendor Auditor (Lesson 1)**: Interactive simulation of the Python script. Users act as the auditor, checking boxes to see real-time Risk Scoring via a Gauge Chart.
         3. **SOC 2 Analyzer (Lesson 2)**: Interactive Report Viewer. Users toggle "Exceptions" on controls to see how the Exception Rate and Risk Level calculations change dynamically (Bar Chart).
         4. **Cloud Responsibility Matrix (Lesson 3)**: Interactive stack visualization. Users toggle between IaaS/PaaS/SaaS/On-Prem to see the "Shared Responsibility" boundary shift visually using color-coded blocks.
         5. **Resources**: Curated links from the source text.
         WHY: This structure moves from concept (Intro) to practice (Audit/Analyze) to framework (Cloud), mirroring the student's learning journey from newbie to analyst.
    -->

    <!-- Visualization & Content Choices:
         1. **Risk Gauge (Vendor Audit)**: Goal: Inform/Change. Chart.js Doughnut (half) to visualize 0-100 score. Justification: Immediate visual feedback on how specific security controls impact the overall score.
         2. **Exception Rate Bar (SOC 2)**: Goal: Compare. Chart.js Bar chart comparing "Passed" vs "Exception". Justification: Visually reinforces the "15% threshold" concept from the text.
         3. **Responsibility Stack (Cloud)**: Goal: Organize/Relationships. HTML/CSS Grid with JS class toggling. Justification: The "stack" is the standard mental model for cloud layers; interactivity reinforces who owns what.
         4. **Dynamic Code/JSON Blocks**: Goal: Inform. JS text updates. Justification: Connects the GUI interaction back to the Python code concepts in the source text.
    -->
    
    <!-- CONFIRMATION: NO SVG graphics used. NO Mermaid JS used. -->
</head>
<body class="flex flex-col min-h-screen">

    <!-- Navigation -->
    <nav class="bg-white border-b border-gray-200 sticky top-0 z-50">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between h-16">
                <div class="flex items-center">
                    <span class="text-2xl font-bold text-gray-800 tracking-tight">Third-Party & Cloud <span class="text-amber-600 text-base font-normal">| Module 10</span></span>
                </div>
                <div class="hidden sm:flex space-x-8 items-center">
                    <button onclick="navTo('section-intro')" class="nav-btn active-nav px-3 py-2 text-sm font-medium text-gray-500 hover:text-gray-900 transition-colors">Mission Brief</button>
                    <button onclick="navTo('section-vendor')" class="nav-btn px-3 py-2 text-sm font-medium text-gray-500 hover:text-gray-900 transition-colors">Vendor Audit</button>
                    <button onclick="navTo('section-soc2')" class="nav-btn px-3 py-2 text-sm font-medium text-gray-500 hover:text-gray-900 transition-colors">SOC 2 Analysis</button>
                    <button onclick="navTo('section-cloud')" class="nav-btn px-3 py-2 text-sm font-medium text-gray-500 hover:text-gray-900 transition-colors">Cloud Matrix</button>
                </div>
                <!-- Mobile menu button placeholder -->
                <div class="flex items-center sm:hidden">
                    <button id="mobile-menu-btn" class="p-2 rounded-md text-gray-400 hover:text-gray-500 hover:bg-gray-100 focus:outline-none">
                        <span class="text-2xl">‚ò∞</span>
                    </button>
                </div>
            </div>
        </div>
        <!-- Mobile Menu -->
        <div id="mobile-menu" class="hidden sm:hidden bg-white border-t border-gray-200">
            <div class="px-2 pt-2 pb-3 space-y-1">
                <button onclick="navTo('section-intro')" class="block w-full text-left px-3 py-2 text-base font-medium text-gray-700 hover:bg-gray-50 hover:text-gray-900">Mission Brief</button>
                <button onclick="navTo('section-vendor')" class="block w-full text-left px-3 py-2 text-base font-medium text-gray-700 hover:bg-gray-50 hover:text-gray-900">Vendor Audit</button>
                <button onclick="navTo('section-soc2')" class="block w-full text-left px-3 py-2 text-base font-medium text-gray-700 hover:bg-gray-50 hover:text-gray-900">SOC 2 Analysis</button>
                <button onclick="navTo('section-cloud')" class="block w-full text-left px-3 py-2 text-base font-medium text-gray-700 hover:bg-gray-50 hover:text-gray-900">Cloud Matrix</button>
            </div>
        </div>
    </nav>

    <!-- Main Content Area -->
    <main class="flex-grow w-full max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8 space-y-12">

        <!-- SECTION 1: INTRO / MISSION BRIEF -->
        <section id="section-intro" class="animate-fade-in">
            <div class="bg-gradient-to-r from-gray-900 to-gray-800 rounded-2xl shadow-xl overflow-hidden text-white mb-8">
                <div class="p-8 md:p-12 relative">
                    <div class="md:w-2/3 z-10 relative">
                        <h1 class="text-3xl md:text-4xl font-extrabold mb-4">Third-Party & Cloud Compliance</h1>
                        <p class="text-lg text-gray-300 mb-6">
                            Welcome to the modern cybersecurity supply chain. Your fortress might be secure, but what about the vendors holding your keys? In this module, you will learn to audit vendors, decode SOC 2 reports, and navigate the Cloud Shared Responsibility Model.
                        </p>
                        <div class="flex flex-wrap gap-4">
                            <button onclick="navTo('section-vendor')" class="bg-amber-600 hover:bg-amber-700 text-white font-bold py-3 px-6 rounded-lg transition-colors shadow-lg flex items-center">
                                Start Audit Simulation ‚ûî
                            </button>
                        </div>
                    </div>
                    <div class="hidden md:block absolute right-0 top-0 h-full w-1/3 opacity-20 bg-[url('https://www.transparenttextures.com/patterns/circuit-board.png')]"></div>
                </div>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                <div class="cyber-card p-6 border-l-4 border-amber-500">
                    <h3 class="font-bold text-xl mb-2 text-gray-800">The Problem</h3>
                    <p class="text-gray-600 text-sm">You operate in an interconnected ecosystem. AWS, SaaS HR tools, marketing platforms‚Äîeach is a potential doorway for attackers. Your security is only as strong as your weakest vendor.</p>
                </div>
                <div class="cyber-card p-6 border-l-4 border-blue-500">
                    <h3 class="font-bold text-xl mb-2 text-gray-800">The Goal</h3>
                    <p class="text-gray-600 text-sm">Transform from compliance-confused to compliance-confident. Learn to perform "Risk Identification," verify "Security Certifications," and understand "Fourth-Party Risk."</p>
                </div>
                <div class="cyber-card p-6 border-l-4 border-emerald-500">
                    <h3 class="font-bold text-xl mb-2 text-gray-800">The Outcome</h3>
                    <p class="text-gray-600 text-sm">Mastering these skills prevents data breaches and ensures you can answer the critical question: "Is our customer data safe with them?"</p>
                </div>
            </div>
        </section>

        <!-- SECTION 2: VENDOR AUDIT SIMULATION -->
        <section id="section-vendor" class="hidden animate-fade-in">
            <div class="mb-8">
                <h2 class="text-3xl font-bold text-gray-900 mb-2">Lesson 1: Vendor Security Audit</h2>
                <p class="text-gray-600 max-w-3xl">
                    Supply chain risk management involves systematic auditing. Below is an interactive simulation of the <code class="bg-gray-100 px-1 rounded text-sm text-pink-600">VendorAuditor</code> class. 
                    Act as the auditor for "ShipQuick Logistics". Check the boxes based on their questionnaire responses to calculate their Risk Score.
                    <br><span class="text-sm italic text-gray-500 mt-1 block">Goal: Achieve a score of 70% or higher to pass.</span>
                </p>
            </div>

            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                <!-- Interactive Questionnaire -->
                <div class="cyber-card p-6">
                    <div class="flex justify-between items-center mb-6">
                        <h3 class="font-bold text-lg text-gray-800">Vendor Questionnaire: ShipQuick</h3>
                        <span class="bg-gray-100 text-gray-600 text-xs font-mono py-1 px-2 rounded">v1.0 Audit Form</span>
                    </div>
                    <div id="vendor-questions" class="space-y-3">
                        <!-- Questions injected via JS -->
                    </div>
                </div>

                <!-- Live Results -->
                <div class="space-y-6">
                    <!-- Gauge Chart -->
                    <div class="cyber-card p-6">
                        <h3 class="font-bold text-lg text-gray-800 mb-4 text-center">Real-Time Risk Score</h3>
                        <div class="chart-container">
                            <canvas id="vendorRiskChart"></canvas>
                        </div>
                        <p id="vendor-verdict" class="text-center font-bold text-xl mt-4 text-gray-400">waiting for input...</p>
                    </div>

                    <!-- JSON Report Output -->
                    <div class="bg-gray-900 rounded-lg p-4 shadow-lg">
                        <div class="flex justify-between items-center mb-2">
                            <span class="text-gray-400 text-xs font-mono uppercase">System Output (JSON)</span>
                            <span class="text-green-500 text-xs">‚óè Live</span>
                        </div>
                        <pre id="vendor-json-output" class="text-xs h-40 overflow-y-auto">
// Awaiting audit data...
                        </pre>
                    </div>
                </div>
            </div>
        </section>

        <!-- SECTION 3: SOC 2 ANALYSIS -->
        <section id="section-soc2" class="hidden animate-fade-in">
            <div class="mb-8">
                <h2 class="text-3xl font-bold text-gray-900 mb-2">Lesson 2: SOC 2 Type II Analysis</h2>
                <p class="text-gray-600 max-w-3xl">
                    Don't just trust; verify. SOC 2 Type II reports evaluate controls over time (6-12 months). Your job is to find the <strong>Exceptions</strong> (failures).
                    Below, analyze the controls for "CloudStore Pro". Toggle controls to "Exception" status to see how it affects the overall risk assessment.
                    <br><span class="text-sm italic text-gray-500 mt-1 block">Thresholds: &lt;5% (Acceptable), 5-15% (Elevated), &gt;15% (High Risk).</span>
                </p>
            </div>

            <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                <!-- Control List -->
                <div class="lg:col-span-2 cyber-card p-6">
                    <div class="flex justify-between items-center mb-6 border-b pb-4">
                        <h3 class="font-bold text-lg text-gray-800">Control Environment Tests</h3>
                        <div class="text-sm text-gray-500">Click to toggle <span class="text-red-600 font-bold">Exception</span></div>
                    </div>
                    <div class="overflow-x-auto">
                        <table class="min-w-full text-sm text-left text-gray-500">
                            <thead class="text-xs text-gray-700 uppercase bg-gray-50">
                                <tr>
                                    <th scope="col" class="px-4 py-3">Control Name</th>
                                    <th scope="col" class="px-4 py-3">Criteria</th>
                                    <th scope="col" class="px-4 py-3">Current Result</th>
                                    <th scope="col" class="px-4 py-3 text-right">Action</th>
                                </tr>
                            </thead>
                            <tbody id="soc2-controls-body">
                                <!-- Rows injected via JS -->
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Analysis Dashboard -->
                <div class="space-y-6">
                    <div class="cyber-card p-6">
                        <h3 class="font-bold text-lg text-gray-800 mb-2">Exception Rate Analysis</h3>
                        <div class="chart-container h-64">
                            <canvas id="soc2Chart"></canvas>
                        </div>
                        <div class="mt-4 border-t pt-4">
                            <div class="flex justify-between text-sm mb-1">
                                <span>Total Controls:</span>
                                <span id="soc2-total" class="font-mono font-bold">10</span>
                            </div>
                            <div class="flex justify-between text-sm mb-1">
                                <span>Exceptions:</span>
                                <span id="soc2-exceptions" class="font-mono font-bold text-red-600">0</span>
                            </div>
                            <div class="flex justify-between text-lg font-bold mt-2">
                                <span>Risk Level:</span>
                                <span id="soc2-risk-level" class="text-green-600">ACCEPTABLE</span>
                            </div>
                            <p id="soc2-recommendation" class="text-xs text-gray-500 mt-2 italic">Vendor demonstrates strong control environment.</p>
                        </div>
                    </div>

                     <div class="bg-amber-50 border border-amber-200 rounded-lg p-4">
                        <h4 class="font-bold text-amber-800 text-sm mb-2">üí° Analyst Note</h4>
                        <p class="text-xs text-amber-900">
                            The <strong>Independent Service Auditor's Report</strong> is key. Look for "unqualified opinion" (Good) vs "qualified opinion" (Bad). Exceptions in the "Tests of Controls" section reveal where the vendor failed their own standards.
                        </p>
                    </div>
                </div>
            </div>
        </section>

        <!-- SECTION 4: CLOUD SHARED RESPONSIBILITY -->
        <section id="section-cloud" class="hidden animate-fade-in">
            <div class="mb-8">
                <h2 class="text-3xl font-bold text-gray-900 mb-2">Lesson 3: Shared Responsibility Model</h2>
                <p class="text-gray-600 max-w-3xl">
                    Who secures what? In the cloud, security is a shared duty. The Provider (AWS/Azure/GCP) secures <em>OF</em> the cloud. You secure <em>IN</em> the cloud.
                    Explore how responsibilities shift based on the service model (IaaS, PaaS, SaaS).
                </p>
            </div>

            <div class="grid grid-cols-1 lg:grid-cols-12 gap-8">
                
                <!-- Controls -->
                <div class="lg:col-span-3 space-y-4">
                    <h3 class="font-bold text-gray-800">Select Service Model</h3>
                    <div class="space-y-2">
                        <button onclick="setCloudModel('iaas')" id="btn-iaas" class="w-full text-left px-4 py-3 rounded-lg border-2 transition-all font-semibold">
                            IaaS <span class="block text-xs font-normal opacity-75">Infrastructure as a Service</span>
                        </button>
                        <button onclick="setCloudModel('paas')" id="btn-paas" class="w-full text-left px-4 py-3 rounded-lg border-2 transition-all font-semibold">
                            PaaS <span class="block text-xs font-normal opacity-75">Platform as a Service</span>
                        </button>
                        <button onclick="setCloudModel('saas')" id="btn-saas" class="w-full text-left px-4 py-3 rounded-lg border-2 transition-all font-semibold">
                            SaaS <span class="block text-xs font-normal opacity-75">Software as a Service</span>
                        </button>
                    </div>
                    
                    <div class="mt-8 bg-blue-50 p-4 rounded-lg border border-blue-100">
                        <h4 class="text-blue-900 font-bold mb-2 text-sm">Legend</h4>
                        <div class="flex items-center gap-2 mb-2">
                            <div class="w-4 h-4 bg-blue-600 rounded"></div>
                            <span class="text-xs text-gray-700">Customer Responsibility</span>
                        </div>
                         <div class="flex items-center gap-2">
                            <div class="w-4 h-4 bg-gray-400 rounded"></div>
                            <span class="text-xs text-gray-700">Provider Responsibility</span>
                        </div>
                    </div>
                </div>

                <!-- The Stack Visualization -->
                <div class="lg:col-span-6">
                    <div class="cyber-card p-6 bg-gray-50">
                        <h3 id="stack-title" class="text-center font-bold text-gray-700 mb-4 text-xl">Infrastructure as a Service (IaaS)</h3>
                        <div class="space-y-1" id="responsibility-stack">
                            <!-- Stack items injected via JS -->
                        </div>
                    </div>
                </div>

                <!-- Context Details -->
                <div class="lg:col-span-3">
                    <div class="cyber-card p-6 h-full border-t-4 border-gray-800">
                        <h3 class="font-bold text-lg text-gray-800 mb-4">Key Takeaways</h3>
                        <div id="cloud-takeaways" class="text-sm text-gray-600 space-y-4">
                            <!-- Dynamic text -->
                        </div>
                        
                        <div class="mt-8 pt-4 border-t border-gray-200">
                            <h4 class="font-bold text-gray-800 text-sm mb-2">Compliance Checker Logic</h4>
                            <p class="text-xs text-gray-500">
                                The Python `CloudComplianceChecker` would audit the <span class="text-blue-600 font-bold">Blue Layers</span>. For example, checking if S3 buckets (Data) are encrypted or if Security Groups (Network) restrict Port 22.
                            </p>
                        </div>
                    </div>
                </div>

            </div>
        </section>

        <!-- Footer / Resources -->
        <section class="border-t border-gray-200 bg-white mt-12 py-12">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                <h2 class="text-2xl font-bold text-gray-900 mb-6">Additional Resources</h2>
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 text-sm">
                    <div>
                        <h4 class="font-bold text-gray-800 mb-2">Standards</h4>
                        <ul class="space-y-1 text-gray-600">
                            <li><a href="#" class="hover:text-amber-600">ISO 27001 Standard</a></li>
                            <li><a href="#" class="hover:text-amber-600">AICPA SOC 2</a></li>
                            <li><a href="#" class="hover:text-amber-600">NIST Cybersecurity Framework</a></li>
                        </ul>
                    </div>
                    <div>
                        <h4 class="font-bold text-gray-800 mb-2">Cloud Docs</h4>
                        <ul class="space-y-1 text-gray-600">
                            <li><a href="#" class="hover:text-amber-600">AWS Shared Responsibility</a></li>
                            <li><a href="#" class="hover:text-amber-600">Azure Security Fundamentals</a></li>
                            <li><a href="#" class="hover:text-amber-600">GCP Security Framework</a></li>
                        </ul>
                    </div>
                    <div>
                        <h4 class="font-bold text-gray-800 mb-2">Tools</h4>
                        <ul class="space-y-1 text-gray-600">
                            <li><a href="#" class="hover:text-amber-600">VirusTotal Scanner</a></li>
                            <li><a href="#" class="hover:text-amber-600">Have I Been Pwned</a></li>
                            <li><a href="#" class="hover:text-amber-600">NIST Supply Chain Risk</a></li>
                        </ul>
                    </div>
                    <div>
                        <h4 class="font-bold text-gray-800 mb-2">Disclaimer</h4>
                        <p class="text-xs text-gray-500">
                            Material property of Cyber.SoHo. Educational purpose only. Not professional legal advice. Always verify external links.
                        </p>
                    </div>
                </div>
                <div class="mt-8 text-center text-gray-400 text-xs">
                    &copy; 2026 Cyber.SoHo Educational Division. Version 1.0
                </div>
            </div>
        </section>

    </main>

    <script>
        // --- NAVIGATION LOGIC ---
        function navTo(sectionId) {
            // Hide all sections
            document.querySelectorAll('main > section').forEach(el => {
                el.classList.add('hidden');
                el.classList.remove('animate-fade-in'); // Reset animation
            });
            
            // Show target
            const target = document.getElementById(sectionId);
            target.classList.remove('hidden');
            void target.offsetWidth; // Trigger reflow for animation
            target.classList.add('animate-fade-in');

            // Update Nav State
            document.querySelectorAll('.nav-btn').forEach(btn => {
                btn.classList.remove('active-nav', 'text-amber-600');
                btn.classList.add('text-gray-500');
            });
            
            // Highlight active button (approximate based on onclick match)
            const activeBtns = Array.from(document.querySelectorAll('.nav-btn')).filter(b => b.getAttribute('onclick').includes(sectionId));
            activeBtns.forEach(b => {
                b.classList.add('active-nav', 'text-amber-600');
                b.classList.remove('text-gray-500');
            });
            
            // Mobile menu hide
            document.getElementById('mobile-menu').classList.add('hidden');
            window.scrollTo(0,0);
        }

        document.getElementById('mobile-menu-btn').addEventListener('click', () => {
            const menu = document.getElementById('mobile-menu');
            menu.classList.toggle('hidden');
        });


        // --- LESSON 1: VENDOR AUDIT LOGIC ---
        const vendorQuestions = [
            "Do you encrypt data at rest?",
            "Do you encrypt data in transit?",
            "Do you perform regular security audits?",
            "Do you have an incident response plan?",
            "Do you provide SOC 2 Type II certification?",
            "Do you implement multi-factor authentication (MFA)?",
            "Do you conduct background checks on employees?",
            "Do you have a disaster recovery plan?",
            "Do you perform penetration testing?",
            "Do you maintain audit logs for at least 90 days?"
        ];
        
        // Initial State: Mix of yes/no similar to the example
        const vendorState = {
            responses: vendorQuestions.map((q, i) => ({ id: i, text: q, answer: true })) // Default all yes
        };

        // Initialize Vendor Chart
        let vendorChart;

        function initVendorModule() {
            const container = document.getElementById('vendor-questions');
            container.innerHTML = '';
            
            vendorState.responses.forEach((item, index) => {
                const div = document.createElement('div');
                div.className = "flex items-start py-2 border-b border-gray-100 last:border-0";
                div.innerHTML = `
                    <div class="flex items-center h-5">
                        <input id="vq-${index}" type="checkbox" ${item.answer ? 'checked' : ''} 
                            class="w-4 h-4 text-amber-600 border-gray-300 rounded focus:ring-amber-500 cursor-pointer"
                            onchange="updateVendorAudit(${index}, this.checked)">
                    </div>
                    <label for="vq-${index}" class="ml-3 text-sm font-medium text-gray-700 cursor-pointer select-none">${item.text}</label>
                `;
                container.appendChild(div);
            });

            // Set specific defaults to match the "ShipQuick" example (80% score)
            // Example had "SOC 2" and "Pen Testing" as NO
            updateVendorAudit(4, false); // SOC 2
            updateVendorAudit(8, false); // Pen Test
        }

        function updateVendorAudit(index, value) {
            vendorState.responses[index].answer = value;
            // Update UI checkbox if called programmatically
            document.getElementById(`vq-${index}`).checked = value;
            
            calculateVendorScore();
        }

        function calculateVendorScore() {
            const total = vendorState.responses.length;
            const positive = vendorState.responses.filter(r => r.answer).length;
            const score = (positive / total) * 100;
            
            let riskLevel = "HIGH RISK";
            let color = "#EF4444"; // Red
            let verdict = "REQUIRES IMPROVEMENT";
            
            if (score >= 80) {
                riskLevel = "LOW RISK";
                color = "#10B981"; // Green
                verdict = "APPROVED FOR CONTRACT";
            } else if (score >= 60) {
                riskLevel = "MEDIUM RISK";
                color = "#F59E0B"; // Amber
                verdict = "CONDITIONAL APPROVAL";
            }

            // Update Text
            const verdictEl = document.getElementById('vendor-verdict');
            verdictEl.textContent = `${riskLevel} (${score}%)`;
            verdictEl.style.color = color;

            // Update Chart
            if (vendorChart) {
                vendorChart.data.datasets[0].data = [score, 100 - score];
                vendorChart.data.datasets[0].backgroundColor = [color, '#E5E7EB'];
                vendorChart.update();
            } else {
                const ctx = document.getElementById('vendorRiskChart').getContext('2d');
                vendorChart = new Chart(ctx, {
                    type: 'doughnut',
                    data: {
                        labels: ['Score', 'Deficiency'],
                        datasets: [{
                            data: [score, 100 - score],
                            backgroundColor: [color, '#E5E7EB'],
                            borderWidth: 0,
                            circumference: 180,
                            rotation: 270
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        cutout: '75%',
                        plugins: {
                            legend: { display: false },
                            tooltip: { enabled: false }
                        }
                    }
                });
            }

            // Generate JSON
            const report = {
                audit_date: new Date().toISOString().replace('T', ' ').substring(0, 19),
                vendor_name: "ShipQuick Logistics",
                security_score: score,
                risk_level: riskLevel,
                passed_audit: score >= 70,
                recommendation: verdict,
                details: {
                    total_controls: total,
                    implemented: positive
                }
            };
            document.getElementById('vendor-json-output').textContent = JSON.stringify(report, null, 4);
        }

        // --- LESSON 2: SOC 2 LOGIC ---
        const soc2Controls = [
            { name: "Access Review", criteria: "Security", result: "No Exception" },
            { name: "Password Policy", criteria: "Security", result: "No Exception" },
            { name: "Backup Testing", criteria: "Availability", result: "Exception" }, // Default Fail
            { name: "Encryption Controls", criteria: "Confidentiality", result: "No Exception" },
            { name: "Change Management", criteria: "Security", result: "No Exception" },
            { name: "Vendor Management", criteria: "Security", result: "Exception" }, // Default Fail
            { name: "Incident Response", criteria: "Security", result: "No Exception" },
            { name: "Data Retention", criteria: "Privacy", result: "No Exception" },
            { name: "Monitoring Controls", criteria: "Security", result: "No Exception" },
            { name: "Business Continuity", criteria: "Availability", result: "No Exception" }
        ];

        let soc2Chart;

        function initSoc2Module() {
            renderSoc2Table();
            updateSoc2Stats();
        }

        function renderSoc2Table() {
            const tbody = document.getElementById('soc2-controls-body');
            tbody.innerHTML = '';
            
            soc2Controls.forEach((control, index) => {
                const isException = control.result === "Exception";
                const row = document.createElement('tr');
                row.className = "bg-white border-b hover:bg-gray-50";
                row.innerHTML = `
                    <td class="px-4 py-3 font-medium text-gray-900">${control.name}</td>
                    <td class="px-4 py-3"><span class="bg-gray-100 text-gray-800 text-xs font-medium px-2.5 py-0.5 rounded">${control.criteria}</span></td>
                    <td class="px-4 py-3">
                        <span class="${isException ? 'text-red-600 font-bold' : 'text-green-600'}">
                            ${isException ? 'Exception ‚ö†Ô∏è' : 'Pass ‚úÖ'}
                        </span>
                    </td>
                    <td class="px-4 py-3 text-right">
                        <button onclick="toggleSoc2Exception(${index})" 
                            class="text-xs px-3 py-1 rounded border transition-colors ${isException ? 'border-green-500 text-green-600 hover:bg-green-50' : 'border-red-500 text-red-600 hover:bg-red-50'}">
                            ${isException ? 'Mark as Pass' : 'Mark Exception'}
                        </button>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }

        function toggleSoc2Exception(index) {
            soc2Controls[index].result = soc2Controls[index].result === "Exception" ? "No Exception" : "Exception";
            renderSoc2Table();
            updateSoc2Stats();
        }

        function updateSoc2Stats() {
            const total = soc2Controls.length;
            const exceptions = soc2Controls.filter(c => c.result === "Exception").length;
            const rate = (exceptions / total) * 100;
            const passes = total - exceptions;

            document.getElementById('soc2-total').textContent = total;
            document.getElementById('soc2-exceptions').textContent = exceptions;

            let riskText = "ACCEPTABLE RISK";
            let riskColor = "text-green-600";
            let rec = "Vendor demonstrates strong control environment";

            if (rate > 15) {
                riskText = "HIGH RISK";
                riskColor = "text-red-600";
                rec = "Significant deficiencies - recommend alternative vendor";
            } else if (rate > 5) {
                riskText = "ELEVATED RISK";
                riskColor = "text-amber-600";
                rec = "Multiple control gaps - require remediation plan";
            }

            const riskEl = document.getElementById('soc2-risk-level');
            riskEl.textContent = `${riskText} (${rate.toFixed(1)}% Exception Rate)`;
            riskEl.className = riskColor;
            document.getElementById('soc2-recommendation').textContent = rec;

            // Chart
            if (soc2Chart) {
                soc2Chart.data.datasets[0].data = [passes, exceptions];
                soc2Chart.update();
            } else {
                const ctx = document.getElementById('soc2Chart').getContext('2d');
                soc2Chart = new Chart(ctx, {
                    type: 'bar',
                    data: {
                        labels: ['Controls Passed', 'Exceptions'],
                        datasets: [{
                            label: 'Count',
                            data: [passes, exceptions],
                            backgroundColor: ['#10B981', '#EF4444'],
                            barThickness: 40
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: { display: false }
                        },
                        scales: {
                            y: { beginAtZero: true, ticks: { stepSize: 1 } }
                        }
                    }
                });
            }
        }

        // --- LESSON 3: CLOUD LOGIC ---
        const cloudLayers = [
            { name: "Data & Content", id: "data" },
            { name: "Application", id: "app" },
            { name: "Runtime/Identity", id: "runtime" },
            { name: "Operating System", id: "os" },
            { name: "Virtualization", id: "virtual" },
            { name: "Compute/Network/Storage", id: "hardware" },
            { name: "Physical Facilities", id: "physical" }
        ];

        // 1 = Customer (Blue), 0 = Provider (Gray)
        const cloudModels = {
            iaas: { // AWS EC2
                title: "Infrastructure as a Service (IaaS)",
                map: [1, 1, 1, 1, 0, 0, 0], 
                desc: "You have the most control and the most responsibility. You manage the OS, apps, and data. Amazon manages the hardware and physical data center.",
                example: "Example: Amazon EC2, Google Compute Engine"
            },
            paas: { // AWS RDS / Heroku
                title: "Platform as a Service (PaaS)",
                map: [1, 1, 0, 0, 0, 0, 0], // Customer owns App + Data. Provider does OS + Runtime.
                desc: "Shared responsibility is split. You focus on your code and data. The provider patches the OS and manages the database engine.",
                example: "Example: AWS RDS, Google App Engine, Azure SQL"
            },
            saas: { // Gmail / Salesforce
                title: "Software as a Service (SaaS)",
                map: [1, 0, 0, 0, 0, 0, 0], // Customer only owns Data/Access
                desc: "Provider handles almost everything. Your ONLY responsibility is configuring users, access controls (IAM), and data encryption.",
                example: "Example: Salesforce, Dropbox, Gmail, Zoom"
            }
        };

        function setCloudModel(modelKey) {
            const model = cloudModels[modelKey];
            
            // Update Buttons
            ['iaas', 'paas', 'saas'].forEach(k => {
                const btn = document.getElementById(`btn-${k}`);
                if (k === modelKey) {
                    btn.classList.add('border-blue-500', 'bg-blue-50', 'ring-2', 'ring-blue-200');
                    btn.classList.remove('border-gray-200', 'bg-white');
                } else {
                    btn.classList.remove('border-blue-500', 'bg-blue-50', 'ring-2', 'ring-blue-200');
                    btn.classList.add('border-gray-200', 'bg-white');
                }
            });

            // Render Stack
            const stackContainer = document.getElementById('responsibility-stack');
            stackContainer.innerHTML = '';
            document.getElementById('stack-title').textContent = model.title;

            cloudLayers.forEach((layer, index) => {
                const isCustomer = model.map[index] === 1;
                const div = document.createElement('div');
                div.className = `p-3 text-center text-sm font-bold text-white rounded transition-all duration-500 transform ${isCustomer ? 'bg-blue-600 scale-105 shadow-md z-10' : 'bg-gray-400 scale-100 opacity-80'}`;
                div.innerHTML = `
                    <div class="flex justify-between items-center px-4">
                        <span>${layer.name}</span>
                        <span class="text-xs font-normal opacity-90 uppercase tracking-wide bg-black bg-opacity-20 px-2 py-0.5 rounded">
                            ${isCustomer ? 'Customer' : 'Provider'}
                        </span>
                    </div>
                `;
                stackContainer.appendChild(div);
            });

            // Text
            const textContainer = document.getElementById('cloud-takeaways');
            textContainer.innerHTML = `
                <p class="font-semibold text-gray-800">${model.example}</p>
                <p>${model.desc}</p>
                <div class="bg-yellow-50 p-3 rounded border border-yellow-200 text-xs text-yellow-800 mt-2">
                    <strong>Critical Note:</strong> Even in ${modelKey.toUpperCase()}, you remain responsible for your <em>data classification</em> and <em>user access</em>.
                </div>
            `;
        }


        // --- INIT ---
        window.addEventListener('load', () => {
            initVendorModule();
            initSoc2Module();
            setCloudModel('iaas'); // Default view
        });

    </script>
</body>
</html>